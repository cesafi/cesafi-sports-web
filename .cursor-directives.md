# CESAFI Sports Website - Cursor AI Development Directives

## ğŸš¨ CRITICAL: MANDATORY FIRST STEP

**BEFORE ANY WORK IN A NEW CHAT SESSION:**

1. **ALWAYS READ THIS DIRECTIVE FILE FIRST** - Use `read_file` tool to read `.cursor-directives.md`
2. **UNDERSTAND THE PROJECT CONTEXT** - Review the architecture, patterns, and current status
3. **FOLLOW ALL DIRECTIVES** - Adhere to the development philosophy, patterns, and quality standards outlined below
4. **REFERENCE THIS FILE** - Use this as your single source of truth for project understanding

**This directive file contains:**

- Complete project architecture understanding
- Development patterns and standards
- Git workflow and branching strategy
- Database structure and relationships
- Security considerations and current issues
- Quality standards and checklists
- All established conventions and best practices

## ğŸ¯ Core Development Philosophy

**QUALITY OVER SPEED**: Every prompt requires deep thinking, thorough analysis, and careful consideration. Sacrifice time and speed for code quality, maintainability, and architectural consistency.

## ğŸ§  Ultra-Thinking Protocol

### Before Any Code Change:

1. **Analyze the full context** - Understand how changes affect the entire system
2. **Prevent redundancy** - Check for existing patterns, utilities, or similar implementations
3. **Consider edge cases** - Think through error scenarios, validation, and data integrity
4. **Evaluate architecture fit** - Ensure changes align with established patterns
5. **Plan for maintainability** - Write code that future developers can easily understand and modify

### Code Quality Checklist:

- [ ] Is this the simplest solution that works?
- [ ] Does this follow existing patterns in the codebase?
- [ ] Are there any potential security vulnerabilities?
- [ ] Is error handling comprehensive?
- [ ] Are types properly defined and validated?
- [ ] Is the code self-documenting?
- [ ] Will this be easy to test?

## ğŸ—ï¸ Project Architecture Understanding

### **Core Architecture Pattern: Layered Service Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PRESENTATION LAYER                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Components    â”‚  â”‚   Pages/Routes  â”‚  â”‚   Contexts   â”‚ â”‚
â”‚  â”‚   (UI/UX)       â”‚  â”‚   (App Router)  â”‚  â”‚  (Providers) â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     DATA ACCESS LAYER                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   React Hooks   â”‚  â”‚  Server Actions â”‚  â”‚   Services   â”‚ â”‚
â”‚  â”‚ (React Query)   â”‚  â”‚   (Next.js)     â”‚  â”‚ (Supabase)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Validation    â”‚  â”‚   Type System   â”‚  â”‚   Database   â”‚ â”‚
â”‚  â”‚   (Zod)         â”‚  â”‚  (TypeScript)   â”‚  â”‚ (Supabase)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Data Flow Pattern:**

1. **UI Components** â†’ **Custom Hooks** (React Query)
2. **Hooks** â†’ **Server Actions** (Next.js)
3. **Server Actions** â†’ **Service Layer** (BaseService pattern)
4. **Services** â†’ **Supabase Database**
5. **Validation** â†’ **Zod schemas** at action level
6. **Caching** â†’ **React Query** with smart invalidation

## ğŸ“ Folder Structure & Responsibilities

### **`src/app/` - Next.js App Router**

- **`(landing)/`** - Route groups for landing pages
- **`(auth)/`** - Authentication routes
- **`layout.tsx`** - Root layout with providers
- **`metadata.ts`** - SEO and metadata configuration
- **`globals.css`** - Global styles and Tailwind imports

### **`src/components/` - React Components**

- **`ui/`** - Shadcn/UI base components (reusable, unstyled)
- **`contexts/`** - React Context providers (QueryProvider, ThemeProvider)
- **Root level** - Feature-specific components

### **`src/lib/` - Utility Libraries**

- **`types/`** - TypeScript type definitions for each entity
- **`validations/`** - Zod validation schemas
- **`supabase/`** - Database client configuration (server/browser)
- **`utils.ts`** - Helper utilities and common functions

### **`src/services/` - Data Access Layer**

- **`base.ts`** - Abstract BaseService class with common CRUD operations
- **Entity services** - Extend BaseService for specific entities
- **Pattern**: `EntityService extends BaseService`

### **`src/actions/` - Next.js Server Actions**

- **Pattern**: One file per entity with CRUD operations
- **Validation**: Zod schemas at action level
- **Error Handling**: Consistent error responses

### **`src/hooks/` - Custom React Hooks**

- **Pattern**: React Query hooks for data fetching
- **Query Keys**: Structured key patterns for cache management
- **Mutations**: Optimistic updates and cache invalidation

## ğŸ”§ Development Patterns & Standards

### **Service Layer Pattern**

```typescript
// BaseService provides common functionality
export abstract class BaseService {
  protected static async getClient(); // Universal client
  protected static formatError<T>(); // Standardized error handling
  protected static async getPaginatedData<T>(); // Generic pagination
}

// Entity services extend BaseService
export class EntityService extends BaseService {
  static async getPaginated(); // Get with filters/pagination
  static async getAll(); // Get all records
  static async getById(); // Single record retrieval
  static async insert(); // Create new record
  static async updateById(); // Update existing record
  static async deleteById(); // Remove record
}
```

### **Hook Pattern**

```typescript
// Query keys for cache management
export const entityKeys = {
  all: ['entities'] as const,
  paginated: (options) => [...entityKeys.all, 'paginated', options] as const,
  details: (id) => [...entityKeys.all, id] as const
};

// React Query hooks
export function usePaginatedEntities(options, queryOptions?) {
  /* ... */
}
export function useEntity(id, queryOptions?) {
  /* ... */
}
export function useCreateEntity() {
  /* ... */
}
export function useUpdateEntity() {
  /* ... */
}
export function useDeleteEntity() {
  /* ... */
}
```

### **Validation Pattern**

```typescript
// Zod schemas for each entity
export const EntityInsertSchema = z.object({
  // Field validations with custom messages
});

export const EntityUpdateSchema = EntityInsertSchema.partial().extend({
  id: z.string().uuid()
});
```

### **Type System Pattern**

```typescript
// Base types
export interface PaginatedResponse<T> {
  data: T[];
  totalCount: number;
  pageCount: number;
  currentPage: number;
}

export type ServiceResponse<T> =
  | { success: true; data: T; id?: string }
  | { success: false; error: string; validationErrors?: Record<string, string[]> };

// Entity-specific types
export interface Entity {
  id: string;
  // ... other fields
}

export interface EntityInsert extends Omit<Entity, 'id' | 'created_at' | 'updated_at'> {}
export interface EntityUpdate extends Partial<EntityInsert> {
  id: string;
}
```

## ğŸš€ Git Workflow & Branching Strategy

### **Current Branch Status:**

- **Active Branch**: `dev` (staging/integration)
- **Production Branch**: `main` (production-ready)
- **Feature Branch**: `feat/facebook-api-implementation` (in progress)

### **Branch Naming Convention:**

- **`feat/<description>`** - New features (e.g., `feat/live-scoreboard`)
- **`fix/<description>`** - Bug fixes (e.g., `fix/login-issue`)
- **`docs/<description>`** - Documentation updates
- **`refactor/<description>`** - Code improvements without new features
- **`chore/<description>`** - Maintenance tasks, dependencies

### **Commit Message Standards:**

```
type(scope): brief description

Detailed explanation of changes, if needed.

- Bullet points for specific changes
- Reference issues: Fixes #123
```

**Types**: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`

### **Workflow:**

1. Create feature branch from `main`
2. Work on changes with frequent commits
3. Open PR against `main`
4. Code review and approval required
5. Merge to `main` â†’ Vercel auto-deployment

## ğŸ—„ï¸ Database Architecture

### **Core Entities & Relationships:**

```
schools (17 institutions)
â”œâ”€â”€ schools_teams (teams per school)
â”‚   â””â”€â”€ match_participants (team participation)
â”‚       â””â”€â”€ matches (game events)
â”‚           â””â”€â”€ games (individual games)
â”‚               â””â”€â”€ game_scores (scoring data)

sports (basketball, volleyball, etc.)
â”œâ”€â”€ sports_seasons_stages (competition stages)
â”‚   â””â”€â”€ matches (scheduled games)

articles (news & content)
â”œâ”€â”€ authored_by (volunteers)

volunteers (staff management)
â”œâ”€â”€ departments (organizational structure)
```

### **Key Database Features:**

- **Row-Level Security (RLS)** - Database-level permissions
- **Real-time subscriptions** - Live updates via Supabase
- **UUID primary keys** - Consistent ID system
- **Audit fields** - `created_at`, `updated_at` timestamps
- **Soft deletes** - `is_active` flags where appropriate

## ğŸ” Security & Authentication

### **Current Security Status:**

- **Middleware**: DISABLED (commented out in `src/middleware.ts`)
- **Authentication**: Supabase Auth with role-based access
- **Roles**: `admin`, `league_operator`, `volunteer`
- **Authorization**: Service-level permission checks

### **Security Headers (Currently Disabled):**

```typescript
// Security headers in middleware (commented out)
'X-Content-Type-Options': 'nosniff'
'X-Frame-Options': 'DENY'
'X-XSS-Protection': '1; mode=block'
'Referrer-Policy': 'strict-origin-when-cross-origin'
'Permissions-Policy': 'camera=(), microphone=(), geolocation=(), interest-cohort=()'
```

## ğŸ§ª Testing Strategy

### **Current Testing Setup:**

- **Framework**: Jest + React Testing Library
- **Configuration**: Next.js optimized setup
- **Status**: No test files exist yet (setup ready)

### **Testing Philosophy:**

- **Unit Tests**: Individual functions, utilities, components
- **Integration Tests**: Component + hook interactions
- **Focus Areas**: Services, validation schemas, custom hooks

## ğŸ¨ UI/UX Standards

### **Design System:**

- **Component Library**: Shadcn/UI (Radix UI primitives)
- **Styling**: Tailwind CSS 4.0
- **Icons**: Lucide React
- **Animations**: Framer Motion
- **Theme**: Light/Dark mode support

### **Component Standards:**

- **Composition over inheritance**
- **Accessibility first** (ARIA labels, keyboard navigation)
- **Responsive design** (mobile-first approach)
- **Consistent spacing** (Tailwind spacing scale)

## ğŸ“¦ Key Dependencies & Versions

### **Core Framework:**

- **Next.js**: 15.4.2 (React 19.1.0)
- **TypeScript**: 5+ (strict mode)
- **Supabase**: 2.52.0 (PostgreSQL + Auth)

### **State Management:**

- **TanStack React Query**: 5.83.0 (data fetching/caching)
- **React Context**: Theme and query providers

### **UI & Styling:**

- **Tailwind CSS**: 4.0
- **Shadcn/UI**: Latest (Radix UI components)
- **Framer Motion**: 12.23.6 (animations)

### **Validation & Types:**

- **Zod**: 4.0.5 (schema validation)
- **TypeScript**: 5+ (type safety)

### **Media & Assets:**

- **Cloudinary**: 6.16.0 (image management)
- **next-cloudinary**: Image optimization

## ğŸš¨ Current Issues & Technical Debt

### **Critical Issues:**

1. **Middleware Disabled** - Security headers commented out
2. **Landing Page** - Currently shows only "test"
3. **No Tests** - Testing framework ready but no tests written

### **Technical Debt:**

1. **Error Handling** - Some services use generic error catching
2. **Type Safety** - Some `any` types in base service
3. **Documentation** - Limited inline code documentation

## ğŸ¯ Development Priorities

### **Immediate (High Priority):**

1. Fix middleware security issues
2. Implement comprehensive testing
3. Complete landing page development
4. Set up proper CI/CD pipeline

### **Short Term:**

1. Live score updates functionality
2. User authentication flows
3. Mobile responsiveness improvements
4. Performance optimizations

### **Long Term:**

1. Advanced analytics and statistics
2. Mobile app (React Native/PWA)
3. Real-time notifications
4. Advanced content management

## ğŸ” Code Quality Standards

### **Readability & Maintainability:**

- **Self-documenting code** - Clear variable/function names
- **Consistent formatting** - Prettier + ESLint
- **Modular design** - Single responsibility principle
- **Type safety** - Comprehensive TypeScript usage

### **Performance Considerations:**

- **React Query caching** - Smart cache invalidation
- **Image optimization** - Next.js + Cloudinary
- **Code splitting** - Automatic via Next.js App Router
- **Bundle optimization** - Tree shaking and dead code elimination

### **Error Handling:**

- **Graceful degradation** - Fallbacks for failed operations
- **User-friendly messages** - Clear error communication
- **Logging** - Proper error tracking and debugging
- **Validation** - Input validation at all boundaries

## ğŸ“‹ Development Checklist

### **Before Starting Work:**

- [ ] Understand the full context and requirements
- [ ] Check existing patterns and implementations
- [ ] Plan the implementation approach
- [ ] Consider edge cases and error scenarios
- [ ] Ensure alignment with architecture

### **During Development:**

- [ ] Follow established patterns and conventions
- [ ] Write self-documenting code
- [ ] Implement comprehensive error handling
- [ ] Add proper TypeScript types
- [ ] Consider performance implications
- [ ] Test functionality thoroughly

### **Before Committing:**

- [ ] Code review against quality standards
- [ ] Ensure no redundant code or logic
- [ ] Verify error handling is comprehensive
- [ ] Check type safety and validation
- [ ] Confirm readability and maintainability
- [ ] Test edge cases and error scenarios

### **Git Workflow:**

- [ ] Create appropriate branch from `main`
- [ ] Write descriptive commit messages
- [ ] Make frequent, focused commits
- [ ] Open PR with detailed description
- [ ] Address review feedback
- [ ] Merge to `main` after approval

---

## ğŸ¯ Final Reminder

**ğŸš¨ MANDATORY FOR EVERY NEW CHAT:**

- **READ THIS DIRECTIVE FILE FIRST** - Always start by reading `.cursor-directives.md`
- **UNDERSTAND THE PROJECT** - Review architecture, patterns, and current status
- **FOLLOW ALL STANDARDS** - Adhere to quality, patterns, and conventions outlined above

**ULTRA-THINKING IS MANDATORY**: Every code change requires deep analysis, architectural consideration, and quality assurance. Take the time to understand the full system, prevent redundancy, and ensure maintainability. Quality over speed, always.

**ARCHITECTURE CONSISTENCY**: Follow established patterns, maintain clean separation of concerns, and ensure all changes fit seamlessly into the existing codebase architecture.

**CLEANLINESS & SIMPLICITY**: Write code that is self-documenting, easy to understand, and simple to maintain. Future developers should be able to understand and modify your code without extensive documentation.

---

## ğŸ“‹ Quick Reference Checklist for New Chats

**Before Starting Any Work:**

- [ ] Read `.cursor-directives.md` file completely
- [ ] Understand current branch status (`dev` branch active)
- [ ] Review project architecture and patterns
- [ ] Check for existing implementations before creating new ones
- [ ] Follow established service/hook/validation patterns
- [ ] Ensure all changes align with quality standards

**Remember:** This directive file is your single source of truth for this project!
