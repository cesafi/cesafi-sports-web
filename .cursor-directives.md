# CESAFI Sports Website - Cursor AI Development Directives

## ğŸš¨ CRITICAL: MANDATORY FIRST STEP

**BEFORE ANY WORK IN A NEW CHAT SESSION:**

1. **ALWAYS READ THIS DIRECTIVE FILE FIRST** - Use `read_file` tool to read `.cursor-directives.md`
2. **UNDERSTAND THE PROJECT CONTEXT** - Review the architecture, patterns, and current status
3. **FOLLOW ALL DIRECTIVES** - Adhere to the development philosophy, patterns, and quality standards outlined below
4. **REFERENCE THIS FILE** - Use this as your single source of truth for project understanding

**This directive file contains:**

- Complete project architecture understanding
- Development patterns and standards
- Git workflow and branching strategy
- Database structure and relationships
- Security considerations and current issues
- Quality standards and checklists
- All established conventions and best practices

## ğŸ¯ Core Development Philosophy

**QUALITY OVER SPEED**: Every prompt requires deep thinking, thorough analysis, and careful consideration. Sacrifice time and speed for code quality, maintainability, and architectural consistency.

## ğŸ§  Ultra-Thinking Protocol

### Before Any Code Change:

1. **Analyze the full context** - Understand how changes affect the entire system
2. **Prevent redundancy** - Check for existing patterns, utilities, or similar implementations
3. **Consider edge cases** - Think through error scenarios, validation, and data integrity
4. **Evaluate architecture fit** - Ensure changes align with established patterns
5. **Plan for maintainability** - Write code that future developers can easily understand and modify

### Code Quality Checklist:

- [ ] Is this the simplest solution that works?
- [ ] Does this follow existing patterns in the codebase?
- [ ] Are there any potential security vulnerabilities?
- [ ] Is error handling comprehensive?
- [ ] Are types properly defined and validated?
- [ ] Is the code self-documenting?
- [ ] Will this be easy to test?

## ğŸ—ï¸ Project Architecture Understanding

### **Core Architecture Pattern: 5-Layer Service Architecture**

The codebase follows a strict **5-layer architecture** designed for scalability, maintainability, and clear separation of concerns:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. COMPONENT LAYER (UI)                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Components    â”‚  â”‚   Pages/Routes  â”‚  â”‚   Contexts   â”‚ â”‚
â”‚  â”‚   (UI/UX)       â”‚  â”‚   (App Router)  â”‚  â”‚  (Providers) â”‚ â”‚
â”‚  â”‚ Thin & Focused  â”‚  â”‚   Next.js 15    â”‚  â”‚  React Query â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    2. HOOKS LAYER (src/hooks/)             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Query Key       â”‚  â”‚ Data Fetching   â”‚  â”‚ Cache        â”‚ â”‚
â”‚  â”‚ Factories       â”‚  â”‚ (useQuery)      â”‚  â”‚ Management   â”‚ â”‚
â”‚  â”‚ Cache Inval.    â”‚  â”‚ Mutations       â”‚  â”‚ & Transform  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   3. ACTIONS LAYER (src/actions/)          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Server Actions  â”‚  â”‚ 'use server'    â”‚  â”‚ Next.js      â”‚ â”‚
â”‚  â”‚ (Next.js 15)    â”‚  â”‚ Directive       â”‚  â”‚ Integration  â”‚ â”‚
â”‚  â”‚ revalidatePath  â”‚  â”‚ API Boundary    â”‚  â”‚ Cache Inval. â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   4. SERVICES LAYER (src/services/)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ BaseService     â”‚  â”‚ Business Logic  â”‚  â”‚ CRUD Ops     â”‚ â”‚
â”‚  â”‚ Pattern         â”‚  â”‚ & Validation    â”‚  â”‚ Pagination   â”‚ â”‚
â”‚  â”‚ Error Handling  â”‚  â”‚ Filtering       â”‚  â”‚ Searching    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    5. DATABASE LAYER                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Supabase        â”‚  â”‚ Auto-generated  â”‚  â”‚ PostgreSQL   â”‚ â”‚
â”‚  â”‚ PostgreSQL      â”‚  â”‚ TypeScript      â”‚  â”‚ + Auth       â”‚ â”‚
â”‚  â”‚ Real-time       â”‚  â”‚ Types           â”‚  â”‚ + Storage    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Detailed Layer Responsibilities:**

#### **1. Component Layer (UI)**

- **React components** in `src/app/` and `src/components/`
- **Thin and focused** on presentation logic only
- **No business logic** - purely UI concerns
- **User interactions** and interface rendering

#### **2. Hooks Layer (src/hooks/)**

- **Data access layer** for components
- **Query key factories** for consistent cache management
- **TanStack Query integration** (useQuery, useMutation)
- **Loading/error state handling**
- **Cache invalidation** and data transformation
- **Component-ready data** preparation

#### **3. Actions Layer (src/actions/)**

- **Server actions** with `'use server'` directive
- **Bridge** between client hooks and server services
- **Next.js integration** (revalidatePath, cache invalidation)
- **Clean API boundary** between client and server
- **Server-side execution** for security and performance

#### **4. Services Layer (src/services/)**

- **Business logic layer** with database operations
- **BaseService pattern** for consistency
- **Universal client management** (server/browser)
- **Standardized error handling**
- **Advanced features**: pagination, filtering, searching, sorting
- **ServiceResponse<T>** standardized return types

#### **5. Database Layer**

- **Supabase PostgreSQL** with auto-generated TypeScript types
- **Type safety** from database to UI
- **Real-time capabilities** and authentication
- **Row-level security** and data integrity

### **Data Flow Architecture:**

#### **Read Operations:**

```
Component â†’ Hook â†’ Service â†’ Supabase â†’ Service â†’ Hook â†’ Component
```

#### **Write Operations:**

```
Component â†’ Hook â†’ Action â†’ Service â†’ Supabase â†’ Service â†’ Action â†’ Hook â†’ Component
(with cache invalidation)
```

**Key Principle**: Each layer has specific responsibilities and **never skips layers**.

## ğŸ“ File Organization Logic (Feature-Based Architecture)

### **Feature-Based Organization Pattern**

The codebase follows a **feature-based organization** where each sports entity has corresponding files across all layers:

```
For each entity (schools, teams, games, matches, etc.):
â”œâ”€â”€ actions/entity.ts      # Server actions
â”œâ”€â”€ services/entity.ts     # Business logic
â”œâ”€â”€ hooks/use-entity.ts    # React Query hooks
â”œâ”€â”€ lib/types/entity.ts    # TypeScript types
â””â”€â”€ lib/validations/entity.ts # Zod schemas
```

**Benefits:**

- **Easy feature discovery** - all related code in predictable locations
- **Complete data flow understanding** - see entire entity lifecycle
- **Consistent patterns** - same structure for all entities
- **Scalable architecture** - add new entities by following established pattern

### **Folder Structure & Responsibilities**

#### **`src/app/` - Next.js App Router**

- **`(landing)/`** - Route groups for landing pages
- **`(auth)/`** - Authentication routes
- **`layout.tsx`** - Root layout with providers
- **`metadata.ts`** - SEO and metadata configuration
- **`globals.css`** - Global styles and Tailwind imports

#### **`src/components/` - React Components**

- **`ui/`** - Shadcn/UI base components (reusable, unstyled)
- **`contexts/`** - React Context providers (QueryProvider, ThemeProvider)
- **Root level** - Feature-specific components

#### **`src/lib/` - Utility Libraries**

- **`types/`** - TypeScript type definitions for each entity
- **`validations/`** - Zod validation schemas
- **`supabase/`** - Database client configuration (server/browser)
- **`utils.ts`** - Helper utilities and common functions

#### **`src/services/` - Data Access Layer**

- **`base.ts`** - Abstract BaseService class with common CRUD operations
- **Entity services** - Extend BaseService for specific entities
- **Pattern**: `EntityService extends BaseService`

#### **`src/actions/` - Next.js Server Actions**

- **Pattern**: One file per entity with CRUD operations
- **Validation**: Zod schemas at action level
- **Error Handling**: Consistent error responses

#### **`src/hooks/` - Custom React Hooks**

- **Pattern**: React Query hooks for data fetching
- **Query Keys**: Structured key patterns for cache management
- **Mutations**: Optimistic updates and cache invalidation

## ğŸ§  State Management Philosophy

### **Server-State-First Approach**

The application follows a **server-state-first** philosophy:

#### **Local Component State (Minimal)**

- **UI concerns only** - form inputs, modal states, loading indicators
- **Temporary state** - user interactions, component visibility
- **No business data** - all business logic in server state

#### **Server State (TanStack Query)**

- **All business data** managed through React Query
- **Automatic caching** and background updates
- **Optimistic updates** for better UX
- **Cache invalidation** after mutations
- **Real-time capabilities** via Supabase subscriptions

#### **State Flow Pattern**

```
User Action â†’ Component State (UI) â†’ Hook (Query) â†’ Action â†’ Service â†’ Database
                â†“
            Cache Update â†’ Component Re-render
```

**Benefits:**

- **Consistent data** across components
- **Automatic synchronization** with server
- **Optimistic updates** for responsive UX
- **Background refetching** for fresh data
- **Error handling** and retry logic

## ğŸ”§ Development Patterns & Standards

### **BaseService Pattern (Critical Architecture Component)**

The `BaseService` class (`src/services/base.ts`) is the **foundation** of the entire service layer:

#### **Client Management**

```typescript
protected static async getClient() {
  const isServer = typeof window === 'undefined';

  if (isServer) {
    const { createClient: createServerClient } = await import('@/lib/supabase/server');
    return createServerClient();
  } else {
    const { createClient: createBrowserClient } = await import('@/lib/supabase/client');
    return createBrowserClient();
  }
}
```

- **Intelligent client instantiation** - automatically detects server vs client environment
- **Universal compatibility** - same service code works in both environments
- **Environment-specific optimization** - uses appropriate Supabase client

#### **Standardized Error Handling**

```typescript
protected static formatError<T>(error: unknown, message: string): ServiceResponse<T> {
  return {
    success: false,
    error: message
  };
}
```

- **Consistent error format** across all services
- **User-friendly error messages**
- **Standardized ServiceResponse<T>** return type

#### **Generic Pagination System**

```typescript
protected static async getPaginatedData<T, TableName extends keyof Database['public']['Tables']>(
  tableName: TableName,
  options: PaginationOptions,
  selectQuery: string = '*'
): Promise<ServiceResponse<PaginatedResponse<T>>>
```

**Advanced Features:**

- **Filtering support**: exact matches, ranges, array filters
- **Full-text search** across specified fields
- **Sorting** by any field (ascending/descending)
- **Automatic count calculation** for pagination metadata
- **Type-safe** with database schema integration

#### **Service Layer Pattern**

```typescript
// BaseService provides common functionality
export abstract class BaseService {
  protected static async getClient(); // Universal client
  protected static formatError<T>(); // Standardized error handling
  protected static async getPaginatedData<T>(); // Generic pagination
}

// Entity services extend BaseService
export class EntityService extends BaseService {
  static async getPaginated(); // Get with filters/pagination
  static async getAll(); // Get all records
  static async getById(); // Single record retrieval
  static async insert(); // Create new record
  static async updateById(); // Update existing record
  static async deleteById(); // Remove record
}
```

### **Hook Pattern (Query Management Architecture)**

#### **Query Key Factory Pattern**

```typescript
// Query keys for cache management
export const entityKeys = {
  all: ['entities'] as const,
  paginated: (options) => [...entityKeys.all, 'paginated', options] as const,
  details: (id) => [...entityKeys.all, id] as const,
  byStage: (stageId) => [...entityKeys.all, 'stage', stageId] as const
};
```

**Query Key Benefits:**

- **Consistent cache keys** across the application
- **Precise cache invalidation** (all entities, paginated results, specific details)
- **Prevents cache key conflicts**
- **Predictable key structures** for debugging
- **Hierarchical invalidation** (invalidate all schools vs specific school)

#### **React Query Hook Pattern**

```typescript
// Data fetching hooks
export function usePaginatedEntities(options, queryOptions?) {
  return useQuery({
    queryKey: entityKeys.paginated(options),
    queryFn: () => getPaginatedEntities(options),
    ...queryOptions
  });
}

export function useEntity(id, queryOptions?) {
  return useQuery({
    queryKey: entityKeys.details(id),
    queryFn: () => getEntityById(id),
    enabled: !!id,
    ...queryOptions
  });
}

// Mutation hooks with cache invalidation
export function useCreateEntity() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: createEntity,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: entityKeys.all });
    }
  });
}

export function useUpdateEntity() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: updateEntity,
    onSuccess: (data) => {
      queryClient.invalidateQueries({ queryKey: entityKeys.all });
      queryClient.invalidateQueries({ queryKey: entityKeys.details(data.id) });
    }
  });
}

export function useDeleteEntity() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: deleteEntity,
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: entityKeys.all });
    }
  });
}
```

**Hook Responsibilities:**

- **Data access layer** for components
- **Loading/error state management**
- **Cache invalidation** after mutations
- **Optimistic updates** where appropriate
- **Component-ready data** transformation

### **Validation Pattern**

```typescript
// Zod schemas for each entity
export const EntityInsertSchema = z.object({
  // Field validations with custom messages
});

export const EntityUpdateSchema = EntityInsertSchema.partial().extend({
  id: z.string().uuid()
});
```

### **Type Safety Architecture (End-to-End)**

The system maintains **type safety from database to UI** through multiple layers:

#### **1. Database Types (Auto-generated)**

```typescript
// database.types.ts - Auto-generated from Supabase
export type Database = {
  public: {
    Tables: {
      schools: {
        Row: { id: string; name: string /* ... */ };
        Insert: { name: string /* ... */ };
        Update: { name?: string /* ... */ };
      };
    };
  };
};
```

#### **2. Service Types (Entity-specific)**

```typescript
// src/lib/types/entities.ts
export interface Entity {
  id: string;
  created_at: string;
  updated_at: string;
  // ... other fields
}

export interface EntityInsert extends Omit<Entity, 'id' | 'created_at' | 'updated_at'> {}
export interface EntityUpdate extends Partial<EntityInsert> {
  id: string;
}

export interface EntityPaginationOptions extends PaginationOptions {
  // Entity-specific filters
}
```

#### **3. Base Type System**

```typescript
// src/lib/types/base.ts
export interface PaginatedResponse<T> {
  data: T[];
  totalCount: number;
  pageCount: number;
  currentPage: number;
}

export type ServiceResponse<T> =
  | { success: true; data: T; id?: string }
  | { success: false; error: string; validationErrors?: Record<string, string[]> };

export interface PaginationOptions<TFilters = Record<string, FilterValue>> {
  page: number;
  pageSize: number;
  searchQuery?: string;
  searchableFields?: string[];
  filters?: TFilters;
  sortBy?: string;
  sortOrder?: 'asc' | 'desc';
}
```

#### **4. Validation Schemas (Runtime Type Safety)**

```typescript
// src/lib/validations/entities.ts
export const EntityInsertSchema = z.object({
  name: z.string().min(1, { message: 'Name is required.' })
  // ... other validations
});

export const EntityUpdateSchema = EntityInsertSchema.partial().extend({
  id: z.string().uuid()
});
```

**Type Safety Benefits:**

- **Compile-time safety** with TypeScript
- **Runtime validation** with Zod schemas
- **Database schema sync** with auto-generated types
- **Consistent interfaces** across all layers
- **IDE support** with autocomplete and error detection

## ğŸš€ Git Workflow & Branching Strategy

### **Current Branch Status:**

- **Active Branch**: `dev` (staging/integration)
- **Production Branch**: `main` (production-ready)
- **Feature Branch**: `feat/facebook-api-implementation` (in progress)

### **Branch Naming Convention:**

- **`feat/<description>`** - New features (e.g., `feat/live-scoreboard`)
- **`fix/<description>`** - Bug fixes (e.g., `fix/login-issue`)
- **`docs/<description>`** - Documentation updates
- **`refactor/<description>`** - Code improvements without new features
- **`chore/<description>`** - Maintenance tasks, dependencies

### **Commit Message Standards:**

```
type(scope): brief description

Detailed explanation of changes, if needed.

- Bullet points for specific changes
- Reference issues: Fixes #123
```

**Types**: `feat`, `fix`, `docs`, `style`, `refactor`, `test`, `chore`

### **Workflow:**

1. Create feature branch from `main`
2. Work on changes with frequent commits
3. Open PR against `main`
4. Code review and approval required
5. Merge to `main` â†’ Vercel auto-deployment

## ğŸ—„ï¸ Database Architecture

### **Core Entities & Relationships:**

```
schools (17 institutions)
â”œâ”€â”€ schools_teams (teams per school)
â”‚   â””â”€â”€ match_participants (team participation)
â”‚       â””â”€â”€ matches (game events)
â”‚           â””â”€â”€ games (individual games)
â”‚               â””â”€â”€ game_scores (scoring data)

sports (basketball, volleyball, etc.)
â”œâ”€â”€ sports_seasons_stages (competition stages)
â”‚   â””â”€â”€ matches (scheduled games)

articles (news & content)
â”œâ”€â”€ authored_by (volunteers)

volunteers (staff management)
â”œâ”€â”€ departments (organizational structure)
```

### **Key Database Features:**

- **Row-Level Security (RLS)** - Database-level permissions
- **Real-time subscriptions** - Live updates via Supabase
- **UUID primary keys** - Consistent ID system
- **Audit fields** - `created_at`, `updated_at` timestamps
- **Soft deletes** - `is_active` flags where appropriate

## ğŸ” Security & Authentication Architecture

### **Supabase Auth Integration**

- **Built-in authentication system** with email/password and social providers
- **Session management** across server and client environments
- **Automatic token refresh** and session persistence
- **Secure cookie handling** for server-side authentication

### **Role-Based Access Control**

```typescript
// Role hierarchy
const ROLES = {
  admin: ['admin', 'league_operator', 'volunteer'],
  league_operator: ['league_operator', 'volunteer'],
  volunteer: ['volunteer']
};
```

**Roles:**

- **`admin`** - Full system access, user management
- **`league_operator`** - Sports management, team operations
- **`volunteer`** - Content creation, basic operations

### **Authorization Implementation**

```typescript
// Service-level permission checks
const authResult = await AuthService.checkAuth(['admin', 'league_operator']);

if (!authResult.authenticated) {
  return { success: false, error: 'Authentication failed.' };
}

if (!authResult.authorized) {
  return { success: false, error: 'Insufficient permissions.' };
}
```

### **Row-Level Security (RLS)**

- **Database-level permission enforcement** via Supabase RLS policies
- **Automatic filtering** based on user roles and permissions
- **Secure data access** without exposing unauthorized data
- **Policy-based access control** for fine-grained permissions

### **Middleware Integration**

- **Session management** across server and client
- **Route protection** for authenticated areas
- **Automatic session refresh** and token validation
- **Security headers** (currently disabled - needs fixing)

### **Current Security Status:**

- **Middleware**: DISABLED (commented out in `src/middleware.ts`)
- **Authentication**: Functional via Supabase Auth
- **Authorization**: Service-level checks implemented
- **RLS**: Database policies in place

### **Security Headers (Currently Disabled):**

```typescript
// Security headers in middleware (commented out)
'X-Content-Type-Options': 'nosniff'
'X-Frame-Options': 'DENY'
'X-XSS-Protection': '1; mode=block'
'Referrer-Policy': 'strict-origin-when-cross-origin'
'Permissions-Policy': 'camera=(), microphone=(), geolocation=(), interest-cohort=()'
```

## âš™ï¸ Environment & Configuration

### **Environment-Based Configuration**

The system uses environment-based configuration for different deployment stages:

#### **Required Environment Variables**

```bash
# Supabase Configuration
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key

# Cloudinary Configuration (for image management)
NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME=your_cloudinary_cloud_name

# Site Configuration
NEXT_PUBLIC_SITE_URL=your_site_url
```

#### **Configuration Files**

- **`next.config.ts`** - Next.js configuration with image optimization for Supabase storage
- **`tsconfig.json`** - TypeScript strict mode configuration
- **`tailwind.config.js`** - Tailwind CSS configuration
- **`eslint.config.mjs`** - ESLint configuration for code quality
- **`jest.config.ts`** - Jest testing configuration

#### **Environment-Specific Settings**

- **Development**: Turbopack for fast builds, hot reloading
- **Production**: Optimized builds, security headers, performance optimizations
- **Testing**: Jest with jsdom environment for React component testing

## ğŸ§ª Testing Strategy

### **Current Testing Setup:**

- **Framework**: Jest + React Testing Library
- **Configuration**: Next.js optimized setup
- **Status**: No test files exist yet (setup ready)

### **Testing Philosophy:**

- **Unit Tests**: Individual functions, utilities, components
- **Integration Tests**: Component + hook interactions
- **Focus Areas**: Services, validation schemas, custom hooks

## ğŸ¨ UI/UX Standards

### **Design System:**

- **Component Library**: Shadcn/UI (Radix UI primitives)
- **Styling**: Tailwind CSS 4.0
- **Icons**: Lucide React
- **Animations**: Framer Motion
- **Theme**: Light/Dark mode support

### **Component Standards:**

- **Composition over inheritance**
- **Accessibility first** (ARIA labels, keyboard navigation)
- **Responsive design** (mobile-first approach)
- **Consistent spacing** (Tailwind spacing scale)

## ğŸ“¦ Key Dependencies & Versions

### **Core Framework:**

- **Next.js**: 15.4.2 (React 19.1.0)
- **TypeScript**: 5+ (strict mode)
- **Supabase**: 2.52.0 (PostgreSQL + Auth)

### **State Management:**

- **TanStack React Query**: 5.83.0 (data fetching/caching)
- **React Context**: Theme and query providers

### **UI & Styling:**

- **Tailwind CSS**: 4.0
- **Shadcn/UI**: Latest (Radix UI components)
- **Framer Motion**: 12.23.6 (animations)

### **Validation & Types:**

- **Zod**: 4.0.5 (schema validation)
- **TypeScript**: 5+ (type safety)

### **Media & Assets:**

- **Cloudinary**: 6.16.0 (image management)
- **next-cloudinary**: Image optimization

## ğŸš¨ Current Issues & Technical Debt

### **Critical Issues:**

1. **Middleware Disabled** - Security headers commented out
2. **Landing Page** - Currently shows only "test"
3. **No Tests** - Testing framework ready but no tests written

### **Technical Debt:**

1. **Error Handling** - Some services use generic error catching
2. **Type Safety** - Some `any` types in base service
3. **Documentation** - Limited inline code documentation

## ğŸ¯ Development Priorities

### **Immediate (High Priority):**

1. Fix middleware security issues
2. Implement comprehensive testing
3. Complete landing page development
4. Set up proper CI/CD pipeline

### **Short Term:**

1. Live score updates functionality
2. User authentication flows
3. Mobile responsiveness improvements
4. Performance optimizations

### **Long Term:**

1. Advanced analytics and statistics
2. Mobile app (React Native/PWA)
3. Real-time notifications
4. Advanced content management

## ğŸ” Code Quality Standards

### **Readability & Maintainability:**

- **Self-documenting code** - Clear variable/function names
- **Consistent formatting** - Prettier + ESLint
- **Modular design** - Single responsibility principle
- **Type safety** - Comprehensive TypeScript usage

### **Performance Considerations:**

- **React Query caching** - Smart cache invalidation
- **Image optimization** - Next.js + Cloudinary
- **Code splitting** - Automatic via Next.js App Router
- **Bundle optimization** - Tree shaking and dead code elimination

### **Error Handling:**

- **Graceful degradation** - Fallbacks for failed operations
- **User-friendly messages** - Clear error communication
- **Logging** - Proper error tracking and debugging
- **Validation** - Input validation at all boundaries

## ğŸ“‹ Development Checklist

### **Before Starting Work:**

- [ ] Understand the full context and requirements
- [ ] Check existing patterns and implementations
- [ ] Plan the implementation approach
- [ ] Consider edge cases and error scenarios
- [ ] Ensure alignment with architecture

### **During Development:**

- [ ] Follow established patterns and conventions
- [ ] Write self-documenting code
- [ ] Implement comprehensive error handling
- [ ] Add proper TypeScript types
- [ ] Consider performance implications
- [ ] Test functionality thoroughly

### **Before Committing:**

- [ ] Code review against quality standards
- [ ] Ensure no redundant code or logic
- [ ] Verify error handling is comprehensive
- [ ] Check type safety and validation
- [ ] Confirm readability and maintainability
- [ ] Test edge cases and error scenarios

### **Git Workflow:**

- [ ] Create appropriate branch from `main`
- [ ] Write descriptive commit messages
- [ ] Make frequent, focused commits
- [ ] Open PR with detailed description
- [ ] Address review feedback
- [ ] Merge to `main` after approval

---

## ğŸ¯ Final Reminder

**ğŸš¨ MANDATORY FOR EVERY NEW CHAT:**

- **READ THIS DIRECTIVE FILE FIRST** - Always start by reading `.cursor-directives.md`
- **UNDERSTAND THE PROJECT** - Review architecture, patterns, and current status
- **FOLLOW ALL STANDARDS** - Adhere to quality, patterns, and conventions outlined above

**ULTRA-THINKING IS MANDATORY**: Every code change requires deep analysis, architectural consideration, and quality assurance. Take the time to understand the full system, prevent redundancy, and ensure maintainability. Quality over speed, always.

**ARCHITECTURE CONSISTENCY**: Follow established patterns, maintain clean separation of concerns, and ensure all changes fit seamlessly into the existing codebase architecture.

**CLEANLINESS & SIMPLICITY**: Write code that is self-documenting, easy to understand, and simple to maintain. Future developers should be able to understand and modify your code without extensive documentation.

---

## ğŸ“‹ Quick Reference Checklist for New Chats

**Before Starting Any Work:**

- [ ] Read `.cursor-directives.md` file completely
- [ ] Understand current branch status (`dev` branch active)
- [ ] Review project architecture and patterns
- [ ] Check for existing implementations before creating new ones
- [ ] Follow established service/hook/validation patterns
- [ ] Ensure all changes align with quality standards

**Remember:** This directive file is your single source of truth for this project!
